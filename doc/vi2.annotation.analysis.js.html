<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>vi2.annotation.analysis.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Analysis.html">Analysis</a></li><li><a href="Annotation.html">Annotation</a><ul class='methods'><li data-type='method'><a href="Annotation.html#init">init</a></li></ul></li><li><a href="Comments.html">Comments</a></li><li><a href="DataBase.html">DataBase</a><ul class='methods'><li data-type='method'><a href="DataBase.html#getGroupById">getGroupById</a></li><li data-type='method'><a href="DataBase.html#getSlidesById">getSlidesById</a></li><li data-type='method'><a href="DataBase.html#getUserById">getUserById</a></li><li data-type='method'><a href="DataBase.html#loadJSON">loadJSON</a></li></ul></li><li><a href="Log.html">Log</a></li><li><a href="Loop.html">Loop</a></li><li><a href="Maintain.html">Maintain</a><ul class='methods'><li data-type='method'><a href="Maintain.html#validateTags">validateTags</a></li></ul></li><li><a href="Parser.html">Parser</a><ul class='methods'><li data-type='method'><a href="Parser.html#parseHtml">parseHtml</a></li><li data-type='method'><a href="Parser.html#parseWiki">parseWiki</a></li><li data-type='method'><a href="Parser.html#parseWikiHyperlink">parseWikiHyperlink</a></li><li data-type='method'><a href="Parser.html#parseWikiVideo">parseWikiVideo</a></li><li data-type='method'><a href="Parser.html#run">run</a></li></ul></li><li><a href="Utils.html">Utils</a></li><li><a href="Vi2.Assessment.html">Assessment</a></li><li><a href="vi2.core.Clock.html">Clock</a><ul class='methods'><li data-type='method'><a href="vi2.core.Clock.html#isHook">isHook</a></li></ul></li><li><a href="Vi2.Metadata.html">Metadata</a><ul class='methods'><li data-type='method'><a href="Vi2.Metadata.html#buildMetaTags">buildMetaTags</a></li><li data-type='method'><a href="Vi2.Metadata.html#displayMetadata">displayMetadata</a></li><li data-type='method'><a href="Vi2.Metadata.html#update">update</a></li></ul></li><li><a href="Vi2.PlaybackSpeed.html">PlaybackSpeed</a><ul class='methods'><li data-type='method'><a href="Vi2.PlaybackSpeed.html#decreaseSpeed">decreaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#displaySpeed">displaySpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#getCurrentSpeed">getCurrentSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#increaseSpeed">increaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#init">init</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#setCurrentSpeed">setCurrentSpeed</a></li></ul></li><li><a href="Vi2.RelatedVideos.html">RelatedVideos</a><ul class='methods'><li data-type='method'><a href="Vi2.RelatedVideos.html#showRelatedVideos">showRelatedVideos</a></li><li data-type='method'><a href="Vi2.RelatedVideos.html#sortByRelevance">sortByRelevance</a></li></ul></li><li><a href="Vi2.Sharing.html">Sharing</a><ul class='methods'><li data-type='method'><a href="Vi2.Sharing.html#init">init</a></li><li data-type='method'><a href="Vi2.Sharing.html#prepareEmbedMarkup">prepareEmbedMarkup</a></li></ul></li><li><a href="Vi2.SkipBack.html">SkipBack</a><ul class='methods'><li data-type='method'><a href="Vi2.SkipBack.html#init">init</a></li></ul></li><li><a href="Vi2.SyncMedia.html">SyncMedia</a><ul class='methods'><li data-type='method'><a href="Vi2.SyncMedia.html#get_tag_by_name">get_tag_by_name</a></li><li data-type='method'><a href="Vi2.SyncMedia.html#init">init</a></li></ul></li><li><a href="Vi2.TableOfContents.html">TableOfContents</a><ul class='methods'><li data-type='method'><a href="Vi2.TableOfContents.html#addTimelineMarkers">addTimelineMarkers</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#appendToDOM">appendToDOM</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#begin">begin</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createMenu">createMenu</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createTimelineControl">createTimelineControl</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#end">end</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#nextElement">nextElement</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#previousElement">previousElement</a></li></ul></li><li><a href="Vi2.TemporalBookmarks.html">TemporalBookmarks</a><ul class='methods'><li data-type='method'><a href="Vi2.TemporalBookmarks.html#init">init</a></li></ul></li><li><a href="Vi2.VideoManager.html">VideoManager</a><ul class='methods'><li data-type='method'><a href="Vi2.VideoManager.html#handleAllStreams">handleAllStreams</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleCategory">handleCategory</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleNewStream">handleNewStream</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleTags">handleTags</a></li><li data-type='method'><a href="Vi2.VideoManager.html#init">init</a></li><li data-type='method'><a href="Vi2.VideoManager.html#loadWidgets">loadWidgets</a></li></ul></li><li><a href="Vi2.ViewingHistory.html">ViewingHistory</a><ul class='methods'><li data-type='method'><a href="Vi2.ViewingHistory.html#init">init</a></li></ul></li><li><a href="Vi2.Zoom.html">Zoom</a><ul class='methods'><li data-type='method'><a href="Vi2.Zoom.html#init">init</a></li></ul></li><li><a href="VideoPlayer.html">VideoPlayer</a><ul class='methods'><li data-type='method'><a href="VideoPlayer.html#createPlaybackControl">createPlaybackControl</a></li><li data-type='method'><a href="VideoPlayer.html#createSource">createSource</a></li><li data-type='method'><a href="VideoPlayer.html#createVolumeControl">createVolumeControl</a></li><li data-type='method'><a href="VideoPlayer.html#decreaseVolume">decreaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#getVolume">getVolume</a></li><li data-type='method'><a href="VideoPlayer.html#increaseVolume">increaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#loadUI">loadUI</a></li><li data-type='method'><a href="VideoPlayer.html#muteVolume">muteVolume</a></li><li data-type='method'><a href="VideoPlayer.html#readyStateHandler">readyStateHandler</a></li><li data-type='method'><a href="VideoPlayer.html#setVolume">setVolume</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-some.html">some</a></li></ul><h3>Global</h3><ul><li><a href="global.html#init">init</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">vi2.annotation.analysis.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* 
*	name: Vi2.Analysis
*	author: niels.seidel@nise81.com
* license: MIT License
*	description: 
* dependencies:
*  - jquery-1.11.2.min.js
*  - jquery.inherit-1.1.1.js
*	todo:

*/


Vi2.Analysis = $.inherit( Vi2.Annotation, /** @lends Analysis# */{

		/** 
		*		@constructs 
		*		@param {object} options An object containing the parameters
		*/
  	__constructor : function(options) {
  			this.options = $.extend(this.options, options); 
		},
		
		name : 'analysis',
		type : 'annotation',
		options : {
			selector : '.control-bar',
			hasTimelineMarker: true, 
			hasMenu : true,
			menuSelector: '.analysis',
			displaySelector : '#seq',
			hasMarker: true,
			hasMarkerSelect:true,
			selectData:['Cat A', 'Cat B', 'Cat C'],
			hasMarkerLabel:true,
			hasMarkerComment:true,
			hasMarkerText:true,
			allowEmoticons : true, 
			allowReplies : true,
			allowEditing : true,
			allowCreation : true, 
			timelineSelector : '.vi2-timeline-bottom',
			path:'/'
		},
		player : null,
		currentMarker : -1,

		/* ... */
		init : function(ann){ 
			if( ann === null ){
				ann = {};
			} 
			var _this = this;
			var events = [];
			$.each(ann, function(i, val){  
				if( val.type === _this.name ){ 
 					events.push({
						name: val.title, 
						occ:[val.t1], 
						time :[val.t1], 
						x:val.x,
						y:val.y,
						date: val.date, 
						author: val.author,
						marker_type: val.marker_type,
						marker_label: val.marker_label,
						marker_select_option: val.marker_select_option, 
						marker_description: val.marker_description,
						id: val.id
					}); 
				}
			});
			
			// show analysis in a menu
			if( this.options.hasMenu ){
				this.createMenu(events);
			}
			
			// map events on the timeline
			if( this.options.hasTimelineMarker ){ 
				vi2.observer.player.timeline.addTimelineMarkers( 'analysis', events, this.options.timelineSelector );
			}
			
			if( this.options.allowCreation ){
				this.addMarker();
			}				
		},
		
		
		/*
		 **/
		addMarker : function(){
			$( this.options.selector + '> .vi2-analysis-controls' ).remove();
		
			// add button to player control bar
			var _this = this;
			var container = $('&lt;div>&lt;/div>')
				.append($('&lt;div>&lt;/div>')
					.text( 'A' )
					.addClass('vi2-analysis-label ')//glyphicon glyphicon-step-backward
				)
				.addClass('vi2-analysis-controls vi2-btn')
				.attr('title', 'add marker')
				.bind('click', function(e){
					vi2.observer.pause();
					var newMarker = $('&lt;a>&lt;/a>')
						.addClass('analysis-marker')
						.draggable({ containment: "parent" })
						.appendTo( _this.options.displaySelector )
						.css({left: '50%', top: '50px', position:'absolute'})
						.bind('click', function(){
							
						})
						;
				})
				.prependTo( this.options.selector );	
		}, 	
		
		
		/*
		*
		**/
		createMenu : function(analysisData){
			var _this = this;
			var tmp_t = -1;
			
			var analysis = $('&lt;ul>&lt;/ul>')
				.addClass('analysis-list');
			$( this.options.menuSelector ).html( analysis );
			
			analysisData = analysisData.sort(function(a, b) {
  			return Number(a.time) > Number(b.time) ? 1 : -1;
			});
			moment.locale('de');
			$.each( analysisData, function(i, val){   
			
				var a = $('&lt;a>&lt;/a>')
					.text(val.name)
					.addClass('id-'+ val.time+' analysis-menu-question' )
					//.attr('href', '#'+vi2.options.id)
					.click(function(){  
						vi2.observer.log({ context:'analysis',action:'menu-click',values: [val.name, val.author, val.time[0] ]} );
						_this.player.currentTime( val.time[0] );
					})
					;	
					
				if( _this.options.allowEmoticons ){
					//a.emoticonize({ /* delay: 800, animate: false, exclude: 'pre, code, .no-emoticons' */ });
				}	
				
				
				var user = vi2.db.getUserById( val.author );	
				
				var header = $('&lt;span>&lt;/span>')
					.addClass('analysis-header');
					
				$('&lt;span>&lt;/span>')
					//.text( user.firstname +' '+user.name )
					.text( user.username )
					.addClass('analysis-user')
					.appendTo( header )
					; 
				header.append(' ' + moment(Number(val.date), "x").fromNow() );	
				
				var li = $('&lt;li>&lt;/li>')
					.addClass('list-item')
					.addClass('t'+val.time)
					.attr('author', val.author)
					.attr('date', 'd'+val.date)
					.attr('id', 't'+_this.formatTime(val.time, '-'))
					.html( header )
					.append(a)
					.appendTo(analysis)
					;

				if( Number(val.time) === Number(tmp_t) ){ 
					li.css({ 'margin-left':'15px' }); 
					// re-comments could be sorted desc by date. Solution needed
					//comments.find('.t'+val.time).tsort({ attr:"date", order:'asc'}); 
				}	

				// edit
				if( _this.options.allowEditing &amp;&amp; Number(val.author) === Number(vi2.wp_user) ){	 
					var edit_btn = $('&lt;a>&lt;/a>')
						.addClass('tiny-edit-btn glyphicon glyphicon-pencil' )
						.attr('data-toggle', "modal")
						.attr('data-target', "#myModal")
						.attr('data-annotationtype', 'analysis')
						.data('annotationdata', { 
							content: val.name, 
							time: val.time, 
							date: val.date,
							author: val.author 
						} )
						.appendTo( header )
						;
				}		
				// re-analysis
				if( _this.options.allowReplies ){		
					var reply_btn = $('&lt;a>&lt;/a>')
						.addClass('tiny-edit-btn glyphicon glyphicon-arrow-right' )
						.attr('data-toggle', "modal")
						.attr('data-target', "#myModal")
						.attr('data-annotationtype', 'analysis')
						.data('annotationdata', { content: '', time: val.time, date: (new Date().getTime()) } )
						.appendTo( header )
						;		
					}	
					
				tmp_t = val.time;		
			}); // end each
		},
		
		/* -- */
		//&lt;div type="toc" starttime=83 duration=1 id="">Objectives of the lecture&lt;/div>
		//
		appendToDOM : function(id){ 
			var _this = this;
			$(vi2.dom).find('[type="analysis"]').each(function(i,val){ $(this).remove(); });
			$.each(	vi2.db.getAnalysisById(id), function( i, val ){ 
				var comm = $('&lt;div>&lt;/div>')
					.attr('type',"analysis")
					.attr('starttime', val.start)
					.attr('duration', 10)
					.attr('author', val.author)
					.attr('x', val.x)
					.attr('y', val.y)
					.attr('date', val.date)
					.attr('marker_type', val.marker_type)
					.attr('marker_label', val.marker_label)
					.attr('marker_select_option', val.marker_select_option) 
					.attr('marker_description', val.marker_description)
					.attr('id', val.id)
					.text( decodeURIComponent(val.analysis))
					.appendTo( vi2.dom )
					
					;  
			});
		},		
		
		
		/*
		**/
		updateDOMElement : function( obj ){
			$(vi2.dom)
				.find('[date="'+ obj.date +'"]')
				.attr('author', vi2.wp_user )
				.attr('date', obj.date)  // its the creation date
				.attr('starttime', obj.time )
				.text( obj.content ); 
		},	
		
		/*
		* { type: type, date: new Date().getTime(), time: formData.time, content: formData.content); 
		**/
		addDOMElement : function( obj ){
			$('&lt;div>&lt;/div>')
				.attr('type', obj.type)
				.attr('author', vi2.wp_user )
				.attr('date', new Date().getTime())
				.attr('starttime', obj.time )
				.text( obj.content )
				.appendTo( vi2.dom );
		},			
	
				
		/*
		 *
		 **/
		begin : function(e, id, obj){ 
			if( this.currentMarker !== obj.id ){
				this.currentMarker = obj.id;
				var _this = this;
				var ltype = $('&lt;span>&lt;/span>')
					.addClass('analysis-marker-wraper marker-id-'+obj.content.target);

				$( this.options.displaySelector ).find( 'analysis-marker-wraper' ).each(function(i, val){ $(val).remove(); });
			
				var o = $('&lt;span>&lt;/span>')
						//.text(' ' +( decodeURIComponent( obj.content.title ) ) )
						.attr('id', 'ov'+id)
						//.attr('href', '#' )
						.attr('title', ( obj.content.description ) )
						.addClass('ov-'+id+' analysis-marker')
						.bind('click', function(data){ alert(obj.marker_type)
							// pause the video
							vi2.observer.player.pause();
						
							// marker + option select
							if( _this.options.hasMarkerSelect &amp;&amp; obj.marker_type === ( 'marker-select' || 'marker-select-desc') ){ 
								var select = $('&lt;select>&lt;/select>');
								for( var i=0; i &lt; _this.options.selectData.length; i++){
									var opt = $('&lt;option>&lt;/option>')
										.html( _this.options.selectData[i] )
										.attr('value', _this.options.selectData[i].toLowerCase() )
										;
									select.append( opt );
								}
								$(this).parent().append( select );
							}	
						
							// marker + label
							if( _this.options.hasMarkerLabel &amp;&amp; obj.marker_type === ( 'marker-label' || 'marker-label-desc') ){ 
								var input = $('&lt;input />').attr('type','text');
								$(this).parent().append( input );
							}
						
							// marker + text
							if( _this.options.hasMarkerText &amp;&amp; obj.marker_type === ( 'marker-desc' || 'marker-label-desc' || 'marker-select-desc') ){ 
								var text = $('&lt;textarea>&lt;/textarea>');//.attr('type','text');
								$(this).parent().append( text );
							}
						
							// remove link ancshor after click 
							//$(this).remove();
						});
					
					
						$(ltype)
							.html(o)
							.appendTo( this.options.displaySelector )
							.css({left: obj.displayPosition.x+'%', top: obj.displayPosition.y+'%', position:'absolute'})
							.effect( "highlight", 500 ) // could be improved
							; 
				 
				// xxx does it work?
				// reset highlight
				$(this.options.menuSelector+' li').each(function(i, val){ 
					$(this).removeClass('vi2-highlight'); 
				});
				// highlight analysis entry
				$(this.options.menuSelector+' li.t' + obj.displayPosition.t1 ).addClass('vi2-highlight');
			}
		},
		
		/*
		 **/
		end:function(e, id){
			// xxx does it work?
			$(this.options.menuSelector+' li ').removeClass('vi2-highlight');
		},
			
			
		/*
		*
		**/
		createAnnotationForm : function( data ){ 
			/*jshint multistr: true */
			var str = "\
			&lt;textarea name='analysis-entry' data-datatype='string' placeholder='' aria-describedby='analysis-form1'>&lt;%= content %>&lt;/textarea>\
			&lt;br>\
			&lt;div class='input-group'>\
				&lt;span class='input-group-addon' id='analysis-form1'>Zeitpunkt (s)&lt;/span>\
				&lt;input type='text' class='form-control' value='&lt;%= time %>' name='analysis-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='analysis-form1'>\
			&lt;/div>\
			";
			if( data ){
				return ejs.render(str, data);
			}	else{
				return ejs.render(str, { 
					content:'', 
					time: vi2.observer.player.currentTime() , 
					date: (new Date().getTime()), 
					author: vi2.wp_user
					});	
			}	
		},
		
		
		/*
		*
		**/
		getAnnotationFormData : function( selector ){
			var obj = {};
			obj.content = $( selector ).find('[name="analysis-entry"]').val();
			obj.time = $( selector ).find('[name="analysis-entry-time"]').attr('value');
			return obj;
		}
	
	
		
	}); // end class Analysis
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Nov 27 2016 13:13:03 GMT+0100 (Западная Европа (зима)) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
