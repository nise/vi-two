<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>vi2.player.loop_rev.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Analysis.html">Analysis</a></li><li><a href="Annotation.html">Annotation</a><ul class='methods'><li data-type='method'><a href="Annotation.html#init">init</a></li></ul></li><li><a href="Comments.html">Comments</a></li><li><a href="DataBase.html">DataBase</a><ul class='methods'><li data-type='method'><a href="DataBase.html#getGroupById">getGroupById</a></li><li data-type='method'><a href="DataBase.html#getSlidesById">getSlidesById</a></li><li data-type='method'><a href="DataBase.html#getUserById">getUserById</a></li><li data-type='method'><a href="DataBase.html#loadJSON">loadJSON</a></li></ul></li><li><a href="Log.html">Log</a></li><li><a href="Loop.html">Loop</a></li><li><a href="Maintain.html">Maintain</a><ul class='methods'><li data-type='method'><a href="Maintain.html#validateTags">validateTags</a></li></ul></li><li><a href="Parser.html">Parser</a><ul class='methods'><li data-type='method'><a href="Parser.html#parseHtml">parseHtml</a></li><li data-type='method'><a href="Parser.html#parseWiki">parseWiki</a></li><li data-type='method'><a href="Parser.html#parseWikiHyperlink">parseWikiHyperlink</a></li><li data-type='method'><a href="Parser.html#parseWikiVideo">parseWikiVideo</a></li><li data-type='method'><a href="Parser.html#run">run</a></li></ul></li><li><a href="Utils.html">Utils</a></li><li><a href="Vi2.Assessment.html">Assessment</a></li><li><a href="vi2.core.Clock.html">Clock</a><ul class='methods'><li data-type='method'><a href="vi2.core.Clock.html#isHook">isHook</a></li></ul></li><li><a href="Vi2.Metadata.html">Metadata</a><ul class='methods'><li data-type='method'><a href="Vi2.Metadata.html#buildMetaTags">buildMetaTags</a></li><li data-type='method'><a href="Vi2.Metadata.html#displayMetadata">displayMetadata</a></li><li data-type='method'><a href="Vi2.Metadata.html#update">update</a></li></ul></li><li><a href="Vi2.PlaybackSpeed.html">PlaybackSpeed</a><ul class='methods'><li data-type='method'><a href="Vi2.PlaybackSpeed.html#decreaseSpeed">decreaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#displaySpeed">displaySpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#getCurrentSpeed">getCurrentSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#increaseSpeed">increaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#init">init</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#setCurrentSpeed">setCurrentSpeed</a></li></ul></li><li><a href="Vi2.RelatedVideos.html">RelatedVideos</a><ul class='methods'><li data-type='method'><a href="Vi2.RelatedVideos.html#showRelatedVideos">showRelatedVideos</a></li><li data-type='method'><a href="Vi2.RelatedVideos.html#sortByRelevance">sortByRelevance</a></li></ul></li><li><a href="Vi2.Sharing.html">Sharing</a><ul class='methods'><li data-type='method'><a href="Vi2.Sharing.html#init">init</a></li><li data-type='method'><a href="Vi2.Sharing.html#prepareEmbedMarkup">prepareEmbedMarkup</a></li></ul></li><li><a href="Vi2.SkipBack.html">SkipBack</a><ul class='methods'><li data-type='method'><a href="Vi2.SkipBack.html#init">init</a></li></ul></li><li><a href="Vi2.SyncMedia.html">SyncMedia</a><ul class='methods'><li data-type='method'><a href="Vi2.SyncMedia.html#get_tag_by_name">get_tag_by_name</a></li><li data-type='method'><a href="Vi2.SyncMedia.html#init">init</a></li></ul></li><li><a href="Vi2.TableOfContents.html">TableOfContents</a><ul class='methods'><li data-type='method'><a href="Vi2.TableOfContents.html#addTimelineMarkers">addTimelineMarkers</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#appendToDOM">appendToDOM</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#begin">begin</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createMenu">createMenu</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createTimelineControl">createTimelineControl</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#end">end</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#nextElement">nextElement</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#previousElement">previousElement</a></li></ul></li><li><a href="Vi2.TemporalBookmarks.html">TemporalBookmarks</a><ul class='methods'><li data-type='method'><a href="Vi2.TemporalBookmarks.html#init">init</a></li></ul></li><li><a href="Vi2.VideoManager.html">VideoManager</a><ul class='methods'><li data-type='method'><a href="Vi2.VideoManager.html#handleAllStreams">handleAllStreams</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleCategory">handleCategory</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleNewStream">handleNewStream</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleTags">handleTags</a></li><li data-type='method'><a href="Vi2.VideoManager.html#init">init</a></li><li data-type='method'><a href="Vi2.VideoManager.html#loadWidgets">loadWidgets</a></li></ul></li><li><a href="Vi2.ViewingHistory.html">ViewingHistory</a><ul class='methods'><li data-type='method'><a href="Vi2.ViewingHistory.html#init">init</a></li></ul></li><li><a href="Vi2.Zoom.html">Zoom</a><ul class='methods'><li data-type='method'><a href="Vi2.Zoom.html#init">init</a></li></ul></li><li><a href="VideoPlayer.html">VideoPlayer</a><ul class='methods'><li data-type='method'><a href="VideoPlayer.html#createPlaybackControl">createPlaybackControl</a></li><li data-type='method'><a href="VideoPlayer.html#createSource">createSource</a></li><li data-type='method'><a href="VideoPlayer.html#createVolumeControl">createVolumeControl</a></li><li data-type='method'><a href="VideoPlayer.html#decreaseVolume">decreaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#getVolume">getVolume</a></li><li data-type='method'><a href="VideoPlayer.html#increaseVolume">increaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#loadUI">loadUI</a></li><li data-type='method'><a href="VideoPlayer.html#muteVolume">muteVolume</a></li><li data-type='method'><a href="VideoPlayer.html#readyStateHandler">readyStateHandler</a></li><li data-type='method'><a href="VideoPlayer.html#setVolume">setVolume</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-some.html">some</a></li></ul><h3>Global</h3><ul><li><a href="global.html#init">init</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">vi2.player.loop_rev.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * name: Vi2.Loop
 * author: Dmitriy Kolotov
 * license: MIT License
 * description:
 * dependencies:
 *  - jquery-1.11.2.min.js
 *  - jquery.inherit-1.1.1.js
 * todo:
 *  - find some nice icons representing the three button states 
 * example: 
 *	- vi-two/examples/hello-world/index.html#!/video/huppert3
 */


Vi2.Loop = $.inherit({

  /** @constructs Loop
   *		@param {object} options An object containing the parameters
   *		@param {boolean} options.hasTimelineMarker Whether the TOC should be annotated on the timeline or not.
   *
   */
  __constructor : function (options) {
    this.options = $.extend(this.options, options);
  },

  name : 'loop',
  type : 'player-widget',
  options : {
    selector : '.control-bar',
    label : '',
    timeline: '.vi2-timeline-main'
  },
  loopButton : {},
  clicks: 0,
  currentTime: 0,
  firstClickCurrentTime: 0,
 	secondClickCurrentTime:0,

  /**
   * Initializes the loop button of content and handles options
   */
  init : function () {
		var _this = this;
    // clear control bar, before playing another video (delete the looping button)
    $(this.options.selector + '> .vi2-loop-controls').remove();

    this.clicks = 0;
		this.loopButton = document.createElement('div');

    // add loop button to player control bar
    this.loopButton.classList.add('vi2-loop-controls', 'vi2-btn', 'vi2-loop-controls-first-point');
    this.loopButton.title = 'Click to define the first point of the loop';
    this.loopButton.addEventListener('click', function(){ _this.loopButtonClickHandler() }, false);
    document.querySelector(this.options.selector).appendChild( this.loopButton );

  },
  
  
  /*
   **/	
	loopButtonClickHandler : function () {
      if (this.clicks === 0) {
        this.firstClickCurrentTime = vi2.observer.player.currentTime();
        // this - div class="vi2-loop-controls"
        this.loopButton.title = 'Click to define the last point of the loop';
        this.loopButton.classList.remove('vi2-loop-controls-first-point');
        this.loopButton.classList.add('vi2-loop-controls-last-point');
        vi2.observer.player.timeline.highlightTimeline( vi2.observer.player.video, this.options.timelineSelector, this.firstClickCurrentTime, this.secondClickCurrentTime, this.clicks);
        this.clicks++;

      } else if (this.clicks === 1) {
        if (vi2.observer.player.currentTime() > this.firstClickCurrentTime) {
          this.secondClickCurrentTime = vi2.observer.player.currentTime();
          vi2.observer.player.timeline.highlightTimeline( vi2.observer.player.video, this.options.timelineSelector, this.firstClickCurrentTime, this.secondClickCurrentTime, this.clicks);

        } else {
          this.secondClickCurrentTime = this.firstClickCurrentTime;
          this.firstClickCurrentTime = vi2.observer.player.currentTime();
          vi2.observer.player.timeline.highlightTimeline( vi2.observer.player.video, this.options.timelineSelector, this.firstClickCurrentTime, this.secondClickCurrentTime, this.clicks);
        }

        // this - div class="vi2-loop-controls"
        this.loopButton.title = 'Click to delete the loop';
        this.loopButton.classList.remove('vi2-loop-controls-last-point');
        this.loopButton.classList.add('vi2-loop-controls-delete');
        vi2.observer.player.video.addEventListener('timeupdate', this.endLoop, false);
        this.clicks++;

      } else {
        vi2.observer.player.video.removeEventListener('timeupdate', this.endLoop, false);
        // this - div class="vi2-loop-controls"
        this.loopButton.title = 'Click to define the first point of the loop';
        this.loopButton.classList.remove('vi2-loop-controls-delete');
        this.loopButton.classList.add('vi2-loop-controls-first-point');
        vi2.observer.player.timeline.deleteHighlightTimeline( this.options.timelineSelector );
        this.clicks -= 2;

  		}
	},
	
	
	/*
	 **/
	endLoop : function() {
      this.loopButton = document.querySelector('.vi2-loop-controls');

      // this - &lt;video>&lt;/video>
      if (this.currentTime >= this.secondClickCurrentTime + 0.5 || this.currentTime &lt; this.firstClickCurrentTime) {
        this.removeEventListener('timeupdate', this.endLoop, false);
        this.loopButton.title = 'Click to define the first point of the loop';
        this.loopButton.classList.remove('vi2-loop-controls-delete');
        this.loopButton.classList.add('vi2-loop-controls-first-point');
        vi2.observer.player.timeline.deleteHighlightTimeline( this.options.timelineSelector );
        this.clicks -= 2;

      } else if (this.currentTime >= this.secondClickCurrentTime) {
        this.currentTime = this.firstClickCurrentTime;
      }
    }

});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Nov 27 2016 13:13:03 GMT+0100 (Западная Европа (зима)) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
