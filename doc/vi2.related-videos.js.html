<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>vi2.related-videos.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Analysis.html">Analysis</a></li><li><a href="Annotation.html">Annotation</a><ul class='methods'><li data-type='method'><a href="Annotation.html#init">init</a></li></ul></li><li><a href="Comments.html">Comments</a></li><li><a href="DataBase.html">DataBase</a><ul class='methods'><li data-type='method'><a href="DataBase.html#getGroupById">getGroupById</a></li><li data-type='method'><a href="DataBase.html#getSlidesById">getSlidesById</a></li><li data-type='method'><a href="DataBase.html#getUserById">getUserById</a></li><li data-type='method'><a href="DataBase.html#loadJSON">loadJSON</a></li></ul></li><li><a href="Log.html">Log</a></li><li><a href="Loop.html">Loop</a></li><li><a href="Maintain.html">Maintain</a><ul class='methods'><li data-type='method'><a href="Maintain.html#validateTags">validateTags</a></li></ul></li><li><a href="Parser.html">Parser</a><ul class='methods'><li data-type='method'><a href="Parser.html#parseHtml">parseHtml</a></li><li data-type='method'><a href="Parser.html#parseWiki">parseWiki</a></li><li data-type='method'><a href="Parser.html#parseWikiHyperlink">parseWikiHyperlink</a></li><li data-type='method'><a href="Parser.html#parseWikiVideo">parseWikiVideo</a></li><li data-type='method'><a href="Parser.html#run">run</a></li></ul></li><li><a href="Utils.html">Utils</a></li><li><a href="Vi2.Assessment.html">Assessment</a></li><li><a href="vi2.core.Clock.html">Clock</a><ul class='methods'><li data-type='method'><a href="vi2.core.Clock.html#isHook">isHook</a></li></ul></li><li><a href="Vi2.Metadata.html">Metadata</a><ul class='methods'><li data-type='method'><a href="Vi2.Metadata.html#buildMetaTags">buildMetaTags</a></li><li data-type='method'><a href="Vi2.Metadata.html#displayMetadata">displayMetadata</a></li><li data-type='method'><a href="Vi2.Metadata.html#update">update</a></li></ul></li><li><a href="Vi2.PlaybackSpeed.html">PlaybackSpeed</a><ul class='methods'><li data-type='method'><a href="Vi2.PlaybackSpeed.html#decreaseSpeed">decreaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#displaySpeed">displaySpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#getCurrentSpeed">getCurrentSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#increaseSpeed">increaseSpeed</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#init">init</a></li><li data-type='method'><a href="Vi2.PlaybackSpeed.html#setCurrentSpeed">setCurrentSpeed</a></li></ul></li><li><a href="Vi2.RelatedVideos.html">RelatedVideos</a><ul class='methods'><li data-type='method'><a href="Vi2.RelatedVideos.html#showRelatedVideos">showRelatedVideos</a></li><li data-type='method'><a href="Vi2.RelatedVideos.html#sortByRelevance">sortByRelevance</a></li></ul></li><li><a href="Vi2.Sharing.html">Sharing</a><ul class='methods'><li data-type='method'><a href="Vi2.Sharing.html#init">init</a></li><li data-type='method'><a href="Vi2.Sharing.html#prepareEmbedMarkup">prepareEmbedMarkup</a></li></ul></li><li><a href="Vi2.SkipBack.html">SkipBack</a><ul class='methods'><li data-type='method'><a href="Vi2.SkipBack.html#init">init</a></li></ul></li><li><a href="Vi2.SyncMedia.html">SyncMedia</a><ul class='methods'><li data-type='method'><a href="Vi2.SyncMedia.html#get_tag_by_name">get_tag_by_name</a></li><li data-type='method'><a href="Vi2.SyncMedia.html#init">init</a></li></ul></li><li><a href="Vi2.TableOfContents.html">TableOfContents</a><ul class='methods'><li data-type='method'><a href="Vi2.TableOfContents.html#addTimelineMarkers">addTimelineMarkers</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#appendToDOM">appendToDOM</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#begin">begin</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createMenu">createMenu</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#createTimelineControl">createTimelineControl</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#end">end</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#init">init</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#nextElement">nextElement</a></li><li data-type='method'><a href="Vi2.TableOfContents.html#previousElement">previousElement</a></li></ul></li><li><a href="Vi2.TemporalBookmarks.html">TemporalBookmarks</a><ul class='methods'><li data-type='method'><a href="Vi2.TemporalBookmarks.html#init">init</a></li></ul></li><li><a href="Vi2.VideoManager.html">VideoManager</a><ul class='methods'><li data-type='method'><a href="Vi2.VideoManager.html#handleAllStreams">handleAllStreams</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleCategory">handleCategory</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleNewStream">handleNewStream</a></li><li data-type='method'><a href="Vi2.VideoManager.html#handleTags">handleTags</a></li><li data-type='method'><a href="Vi2.VideoManager.html#init">init</a></li><li data-type='method'><a href="Vi2.VideoManager.html#loadWidgets">loadWidgets</a></li></ul></li><li><a href="Vi2.ViewingHistory.html">ViewingHistory</a><ul class='methods'><li data-type='method'><a href="Vi2.ViewingHistory.html#init">init</a></li></ul></li><li><a href="Vi2.Zoom.html">Zoom</a><ul class='methods'><li data-type='method'><a href="Vi2.Zoom.html#init">init</a></li></ul></li><li><a href="VideoPlayer.html">VideoPlayer</a><ul class='methods'><li data-type='method'><a href="VideoPlayer.html#createPlaybackControl">createPlaybackControl</a></li><li data-type='method'><a href="VideoPlayer.html#createSource">createSource</a></li><li data-type='method'><a href="VideoPlayer.html#createVolumeControl">createVolumeControl</a></li><li data-type='method'><a href="VideoPlayer.html#decreaseVolume">decreaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#getVolume">getVolume</a></li><li data-type='method'><a href="VideoPlayer.html#increaseVolume">increaseVolume</a></li><li data-type='method'><a href="VideoPlayer.html#loadUI">loadUI</a></li><li data-type='method'><a href="VideoPlayer.html#muteVolume">muteVolume</a></li><li data-type='method'><a href="VideoPlayer.html#readyStateHandler">readyStateHandler</a></li><li data-type='method'><a href="VideoPlayer.html#setVolume">setVolume</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-some.html">some</a></li></ul><h3>Global</h3><ul><li><a href="global.html#init">init</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">vi2.related-videos.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* 
* name: Vi2.RelatedVideos
* author: niels.seidel@nise81.com
* license: MIT License
* description: 
* dependencies:
*  - jquery-1.11.2.min.js
*  - jquery.inherit-1.1.1.js
* to-do:
*  - implement random-destructor => @db random array sort missing
*  - exclude videos that have been watched already => make dependency to ViewingHistory 
*  - add categorie as possible criterion
*  - add updated_at / created_at as a criterion
*  - (server side) 	- users that have seen this video also whatched this
*  - check literature about other algorithms for recommender systems
*/


Vi2.RelatedVideos = $.inherit(/** @lends Vi2.RelatedVideos# */{

		/** 
		*		@constructs 
		*		@param {object} options 
		*		@param {object} options.criteria Object...
		*		@param {Number} options.criteria.weight Weight of the given criteria
		*		@param {Number} options.limit Number of requestested related videos
		*/
  	__constructor : function(options) {  
  		this.options = $.extend(this.options, options); 
		},
				
		name : 'related-videos',
		options : {
			resultSelector:'.related-videos', 
			limit : 10, 
			criteria: [ 
				{ criterion: 'random-destructor', weight:0.2 },
				{ criterion: 'outgoing-links', weight:0.4 },
				{ criterion: 'incomming-links', weight:0.4 },
				{ criterion: 'outgoing-links', weight:0.8 },
				{ criterion: 'same-author', weight:0.8 }
				]
			},
		results : {},		
		player : null,
		
		/* ... */
		init : function(ann){ 
			//var _this = this;
			//this.link_list = this.buildLinkList(ann);	
			this.determineCriteria( vi2.observer.current_stream );
		},
		
		
		/* -- */
		determineCriteria : function(id){
			var _this = this;
			this.results = {};
			$.each( this.options.criteria, function(i, criterion){ 
				switch(criterion.criterion){
					case "random-destructor" :
						_this.weightResults( vi2.db.getRandomStreams(id), criterion.weight );	
						break;
					case "incomming-links" :
						_this.weightResults( vi2.db.getLinkSourcesById(id), criterion.weight );	
						break;
					case "outgoing-links" :
						_this.weightResults( vi2.db.getLinkTargetsById(id), criterion.weight );	
						break;
					case "same-author"	:
						_this.weightResults( vi2.db.getStreamsOfSameAuthor(id), criterion.weight );	
						break;
					case "same-tags"	: 
						_this.weightResults( vi2.db.getStreamsWithSameTag(id), criterion.weight );	
						break;
					default :
						// do nothing			
				}
			}); 
			// render results
			this.showRelatedVideos();
		},
		
		
		/*
		* @res {object} {&lt;stream-id>: &lt;number of occurances>}
		**/
		weightResults : function(res, weight){   
			var _this = this;
			$.each(res, function(i, val){ 
				if( val in _this.results === false ){  
					_this.results[ val ] = 0;
				} 
				_this.results[ val ] += Math.floor( weight * 10) / 10; // bug: strange floating number as result
			});
			
		},
		
		/**
		
		*/
		sortByRelevance : function(arr){
			var sortable = [];
			for (var el in arr){
						sortable.push([el, arr[el]]);
			}			
			return sortable.sort(function(a, b) { 
				return  b[1] - a[1]; 
			});
		},
		
		
		/** 
		Renders results
		*/
		showRelatedVideos : function(id){
			var _this = this;
			// sort by relevance 
			this.results = this.sortByRelevance( this.results );
			var ul = $('&lt;ul>&lt;/ul>');
			
			var j = 0;	  
			$.each(this.results, function(i,val){ 
				if( j &lt; _this.options.limit ){ 
					var t = val.toString().split(','); 
					var li = $('&lt;li>&lt;/li>').appendTo(ul);
					var meta = vi2.db.getMetadataById(t[0])
					var title = meta.title +' ('+ meta.author + ')';
					var a = $('&lt;a>&lt;/a>')
						.attr('href','#!/video/' + t[0] + '')
						.text( title + ' (' + Number(t[1]).toFixed(1) + ')')
						.appendTo(li);
					;	
				}
				j++;
			});
			$( this.options.resultSelector ).html( ul );
		}	
		
		


		/** deprecated ... 
		showLinkSummary : function(e){ return;
		 var _this = this;
			var screen = observer.openScreen(this.options.resultSelector);
			// prepare link list (remove doubles)
			var ex = [];
			$.each(_this.link_list.tags, function(i, val){
				if(ex.indexOf(val.target) == -1){
					val.name = vi2.db.getMetadataById(val.target.replace(/\#!/, '')).title; 
					ex.push(val.target);
				}else{ 
					val.name = 0; val.target = '';
				}
				
			});
			// use template
			screen.setTemplate('&lt;div>&lt;h3>Related Lectures:&lt;/h3>&lt;ul>{#foreach $T.tags as link}{#if $T.link.name == 0}{#else}&lt;li>&lt;a href="{$T.link.target}">{$T.link.name}&lt;/a>&lt;/li>{#/if}{#/foreach}&lt;/ul>&lt;/div>');
			screen.processTemplate(_this.link_list);
			
		}
		 */
		
		
	}); // end class RelatedVideos		
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Nov 27 2016 13:13:03 GMT+0100 (Западная Европа (зима)) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
